<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cov.bloom.mypage.model.dao.MypageMapper">

    <resultMap id="memberResultMap" type="com.cov.bloom.member.model.dto.LoginMemberDTO">
        <id property="no" column="member_no"/>
        <result property="email" column="member_email"/>
        <result property="password" column="member_password"/>
        <result property="nickname" column="member_nickname"/>
        <result property="name" column="member_name"/>
        <result property="phone" column="member_phone"/>
        <result property="auth" column="member_auth"/>
        <result property="status" column="member_status"/>
    </resultMap>

    <resultMap id="myorderlist" type="com.cov.bloom.order.model.dto.MyOrder">
        <id property="orderNo" column="order_no"></id>
        <result property="portTitle" column="port_title"/>
        <result property="memberNick" column="member_nickname"/>
        <result property="orderDt" column="order_dt"/>
        <result property="orderFinalDt" column="order_finaldt"/>
        <result property="price" column="option_price"/>
        <result property="requestStatus" column="request_status"/>
    </resultMap>

    <update id="updateNickname" parameterType="string">
        UPDATE MEMBER
        SET MEMBER_NICKNAME = #{ nickname }
        WHERE MEMBER_EMAIL = #{ memberName }

    </update>
    <update id="updatePhone" parameterType="string">
        UPDATE MEMBER
        SET MEMBER_PHONE = #{ phone }
        WHERE MEMBER_EMAIL = #{ memberName }

    </update>

    <select id="findByUsername" parameterType="string" resultMap="memberResultMap">
        SELECT
        MEMBER_NO
        ,MEMBER_EMAIL
        ,MEMBER_PASSWORD
        ,MEMBER_NICKNAME
        ,MEMBER_NAME
        ,MEMBER_PHONE
        ,member_auth
        ,member_status
        FROM member
        WHERE member_email = #{ email }
    </select>

    <!--주문내역 조회-->
    <select id="findAllOrderList" parameterType="_int" resultType="java.util.List" resultMap="myorderlist">
        select
        order_no
        ,port_title
        ,member_nickname
        ,order_dt
        ,order_finaldt
        ,option_price
        ,request_status
        from (
        select
        od.order_no
        ,por.port_title
        ,por.member_no
        ,od.order_dt
        ,od.order_finaldt
        ,op.option_price
        ,od.request_status
        from(
        select * from orders where member_no = #{ memberNo }
        ) as od
        join port_option op on od.option_no = op.option_no
        join portfolio por on por.port_no = od.port_no
        ) as a
        join member m on a.member_no = m.member_no;
    </select>

    <update id="deleteMember" parameterType="string">
        UPDATE MEMBER
        SET MEMBER_STATUS = 'y'
        WHERE MEMBER_EMAIL = #{ memberName }
    </update>

    <update id="getSales" parameterType="string">
        UPDATE MEMBER
        SET MEMBER_AUTH = 's'
        WHERE MEMBER_EMAIL = #{ memberName }
    </update>





</mapper>